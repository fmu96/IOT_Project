-- phpMyAdmin SQL Dump
-- version 4.9.2
-- https://www.phpmyadmin.net/
--
-- Host: 127.0.0.1
-- Generation Time: Sep 15, 2020 at 01:07 PM
-- Server version: 10.4.10-MariaDB
-- PHP Version: 7.3.12

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
SET AUTOCOMMIT = 0;
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `nodered`
--

DELIMITER $$
--
-- Procedures
--
CREATE DEFINER=`root`@`localhost` PROCEDURE `add_beacon` (IN `uuid` TEXT CHARSET utf8)  NO SQL
BEGIN
set @count = (SELECT COUNT(beacon.uuid) from beacon where beacon.uuid=uuid);
if @count=0 THEN
INSERT INTO beacon (beacon.uuid) VALUES(uuid);
end if; 
end$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `add_room` (IN `name` TEXT)  NO SQL
BEGIN
set @count =( SELECT COUNT(room.room_name) from room where room.room_name=name);
if @count=0 THEN

INSERT INTO room (room.room_name) VALUES(name);
end if; 
end$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `tracking` (IN `room_name` TEXT CHARSET utf8, IN `uuid_id` TEXT CHARSET utf8, IN `state` TINYINT)  NO SQL
BEGIN
INSERT INTO track (track.room_id,track.bea_id,track.state,track.time) VALUES((SELECT room.id FROM room where room.room_name=room_name),(SELECT beacon.id FROM beacon WHERE beacon.uuid=uuid_id),state,NOW());
END$$

DELIMITER ;

-- --------------------------------------------------------

--
-- Table structure for table `beacon`
--

CREATE TABLE `beacon` (
  `id` int(11) NOT NULL,
  `uuid` text NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Dumping data for table `beacon`
--

INSERT INTO `beacon` (`id`, `uuid`) VALUES
(19, '8f83ew8w-r345-9897-f456-123rer45reer'),
(20, '88uj2wf3-r345-9897-f456-123rer45reer'),
(21, '88iir7rd-r345-9897-f456-123rer45reer'),
(22, '98jyd66d-r345-9897-f456-123rer45reer'),
(23, '678re8e-r345-9897-f456-123rer45reer'),
(24, 'gfs345e-r345-9897-f456-123rer45reer'),
(25, 'dg46hfd-r345-9897-f456-gdsgh345dg'),
(26, '98jyd66d-f456-9897-f456-fgfe543fdf'),
(27, '9c34c078-0c16-4812-8f61-a0d027c17538'),
(28, '820af0fa-c342-45e6-ba73-886ac49d7d77'),
(29, '8492e75f-4fd6-469d-b132-043fe94921d8'),
(30, 'c3a317f6-f48b-40bc-b43d-a46af5ff5fc7'),
(31, 'hj87666-r345-9897-f456-gdsgh345dg'),
(32, '5464g64-f456-9897-f456-fgfe543fdf'),
(33, '4444444-r345-9897-f456-123rer45reer'),
(34, 'c6530d27-0fad-419f-8a65-a04d1b6bcce9'),
(35, '26878553-d987-46f4-8a78-b1ed7895b0e4'),
(36, '386dea98-ac2c-4c1d-aa01-57363f48eed7');

-- --------------------------------------------------------

--
-- Table structure for table `room`
--

CREATE TABLE `room` (
  `id` int(11) NOT NULL,
  `room_name` text NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Dumping data for table `room`
--

INSERT INTO `room` (`id`, `room_name`) VALUES
(11, 'DSRI/class/'),
(12, 'DSRI/office/');

-- --------------------------------------------------------

--
-- Table structure for table `track`
--

CREATE TABLE `track` (
  `id` int(11) NOT NULL,
  `room_id` int(11) NOT NULL,
  `bea_id` int(11) NOT NULL,
  `state` tinyint(4) NOT NULL,
  `time` datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Dumping data for table `track`
--

INSERT INTO `track` (`id`, `room_id`, `bea_id`, `state`, `time`) VALUES
(58, 11, 19, 1, '2020-08-29 19:04:16'),
(59, 11, 20, 1, '2020-08-29 19:04:32'),
(60, 11, 21, 1, '2020-08-29 19:04:36'),
(61, 11, 22, 1, '2020-08-29 19:04:37'),
(62, 12, 23, 1, '2020-08-29 19:04:55'),
(63, 12, 24, 1, '2020-08-29 19:04:56'),
(64, 12, 25, 1, '2020-08-29 19:04:57'),
(65, 12, 26, 1, '2020-08-29 19:04:58'),
(66, 12, 23, 0, '2020-08-29 19:05:12'),
(67, 12, 23, 1, '2020-09-10 17:17:27'),
(68, 11, 19, 1, '2020-09-10 17:17:35'),
(69, 11, 20, 1, '2020-09-10 17:17:48'),
(70, 12, 26, 1, '2020-09-10 17:18:04'),
(71, 12, 25, 1, '2020-09-10 17:18:05'),
(72, 11, 22, 1, '2020-09-10 17:18:10'),
(73, 11, 21, 1, '2020-09-10 17:18:12'),
(74, 12, 24, 1, '2020-09-10 18:07:08'),
(75, 12, 23, 1, '2020-09-10 18:07:08'),
(76, 12, 25, 1, '2020-09-10 18:07:09'),
(77, 12, 26, 1, '2020-09-10 18:07:09'),
(78, 11, 21, 1, '2020-09-10 18:07:11'),
(79, 12, 26, 1, '2020-09-10 18:07:30'),
(80, 12, 25, 1, '2020-09-10 18:07:30'),
(81, 12, 24, 1, '2020-09-10 18:07:31'),
(82, 12, 23, 1, '2020-09-10 18:07:32'),
(83, 11, 19, 1, '2020-09-10 18:08:37'),
(84, 11, 20, 1, '2020-09-10 18:08:38'),
(85, 11, 21, 1, '2020-09-10 18:08:39'),
(86, 11, 22, 1, '2020-09-10 18:08:39'),
(87, 12, 23, 1, '2020-09-10 18:08:40'),
(88, 12, 24, 1, '2020-09-10 18:08:41'),
(89, 12, 25, 1, '2020-09-10 18:08:41'),
(90, 12, 26, 1, '2020-09-10 18:08:42'),
(91, 12, 23, 1, '2020-09-10 18:09:32'),
(92, 12, 25, 1, '2020-09-10 18:09:33'),
(93, 11, 19, 1, '2020-09-10 18:09:35'),
(94, 11, 20, 1, '2020-09-10 18:09:38'),
(95, 11, 21, 1, '2020-09-10 18:09:38'),
(96, 12, 23, 1, '2020-09-10 18:37:59'),
(97, 11, 19, 1, '2020-09-10 18:38:00'),
(98, 11, 20, 1, '2020-09-10 18:38:01'),
(99, 11, 21, 1, '2020-09-10 18:38:02'),
(100, 11, 22, 1, '2020-09-10 18:38:03'),
(101, 12, 23, 1, '2020-09-11 13:51:26'),
(102, 12, 24, 1, '2020-09-11 13:51:30'),
(103, 11, 20, 1, '2020-09-11 13:52:00'),
(104, 11, 19, 1, '2020-09-11 13:52:00'),
(105, 11, 21, 1, '2020-09-11 13:52:11'),
(106, 11, 22, 1, '2020-09-11 13:52:11'),
(107, 12, 23, 1, '2020-09-11 13:52:50'),
(108, 12, 24, 1, '2020-09-11 13:52:50'),
(109, 12, 25, 1, '2020-09-11 13:52:51'),
(110, 12, 26, 1, '2020-09-11 13:52:52'),
(111, 11, 19, 1, '2020-09-11 13:53:00'),
(112, 11, 27, 0, '2020-09-11 18:20:30'),
(113, 11, 27, 1, '2020-09-11 18:21:34'),
(114, 11, 27, 0, '2020-09-11 18:22:37'),
(115, 11, 27, 1, '2020-09-11 18:24:11'),
(116, 11, 27, 0, '2020-09-11 18:25:28'),
(117, 11, 27, 1, '2020-09-11 18:25:48'),
(118, 11, 27, 0, '2020-09-11 18:26:40'),
(119, 11, 28, 1, '2020-09-11 18:28:40'),
(120, 11, 28, 0, '2020-09-11 18:29:56'),
(121, 11, 29, 1, '2020-09-11 18:30:35'),
(122, 11, 28, 1, '2020-09-11 18:31:54'),
(123, 11, 29, 0, '2020-09-11 18:31:57'),
(124, 11, 19, 1, '2020-09-11 18:32:06'),
(125, 11, 20, 1, '2020-09-11 18:32:08'),
(126, 11, 21, 1, '2020-09-11 18:32:09'),
(127, 11, 22, 1, '2020-09-11 18:32:10'),
(128, 11, 28, 0, '2020-09-11 18:32:19'),
(129, 11, 29, 1, '2020-09-11 18:32:23'),
(130, 11, 29, 0, '2020-09-11 18:34:00'),
(131, 11, 29, 1, '2020-09-11 18:34:00'),
(132, 11, 29, 0, '2020-09-11 18:35:29'),
(133, 11, 29, 1, '2020-09-11 18:36:56'),
(134, 11, 28, 1, '2020-09-11 18:37:30'),
(135, 11, 28, 0, '2020-09-11 18:37:45'),
(136, 11, 29, 0, '2020-09-11 18:38:07'),
(137, 11, 29, 1, '2020-09-11 18:38:23'),
(138, 12, 23, 1, '2020-09-11 18:38:51'),
(139, 12, 24, 1, '2020-09-11 18:38:51'),
(140, 12, 25, 1, '2020-09-11 18:38:52'),
(141, 12, 26, 1, '2020-09-11 18:38:53'),
(142, 11, 22, 1, '2020-09-11 18:39:07'),
(143, 11, 21, 1, '2020-09-11 18:39:07'),
(144, 11, 22, 0, '2020-09-11 18:39:16'),
(145, 11, 21, 0, '2020-09-11 18:39:16'),
(146, 11, 20, 0, '2020-09-11 18:39:18'),
(147, 11, 20, 1, '2020-09-11 18:39:30'),
(148, 11, 21, 1, '2020-09-11 18:39:32'),
(149, 11, 22, 1, '2020-09-11 18:39:36'),
(150, 11, 22, 0, '2020-09-11 18:39:39'),
(151, 11, 21, 0, '2020-09-11 18:39:39'),
(152, 11, 29, 0, '2020-09-11 18:39:59'),
(153, 11, 21, 1, '2020-09-11 19:21:47'),
(154, 12, 25, 1, '2020-09-11 19:44:09'),
(155, 12, 26, 1, '2020-09-11 19:44:10'),
(156, 11, 21, 1, '2020-09-11 19:44:17'),
(157, 11, 22, 1, '2020-09-11 19:44:18'),
(158, 11, 30, 1, '2020-09-11 19:45:33'),
(159, 11, 21, 1, '2020-09-11 19:45:48'),
(160, 11, 22, 1, '2020-09-11 19:45:49'),
(161, 11, 29, 1, '2020-09-11 19:45:57'),
(162, 11, 30, 0, '2020-09-11 19:46:07'),
(163, 12, 25, 1, '2020-09-11 19:46:12'),
(164, 12, 26, 1, '2020-09-11 19:46:13'),
(165, 11, 29, 0, '2020-09-11 19:46:22'),
(166, 12, 19, 1, '2020-09-11 19:47:00'),
(167, 11, 21, 1, '2020-09-11 21:55:56'),
(168, 11, 22, 1, '2020-09-11 21:56:19'),
(169, 12, 22, 1, '2020-09-12 09:53:07'),
(170, 11, 21, 1, '2020-09-12 09:53:18'),
(171, 12, 19, 1, '2020-09-12 09:53:33'),
(172, 11, 22, 1, '2020-09-12 09:53:36'),
(173, 12, 31, 1, '2020-09-12 09:54:02'),
(174, 11, 32, 1, '2020-09-12 09:54:26'),
(175, 12, 19, 1, '2020-09-12 09:55:22'),
(176, 12, 22, 1, '2020-09-12 09:55:40'),
(177, 11, 21, 1, '2020-09-12 09:55:47'),
(178, 11, 22, 1, '2020-09-12 09:55:53'),
(179, 11, 32, 1, '2020-09-12 09:55:58'),
(180, 11, 21, 0, '2020-09-12 09:56:03'),
(181, 11, 22, 1, '2020-09-12 10:16:26'),
(182, 11, 21, 1, '2020-09-12 10:16:27'),
(183, 12, 22, 1, '2020-09-12 10:16:30'),
(184, 12, 19, 1, '2020-09-12 10:16:31'),
(185, 12, 25, 0, '2020-09-12 10:16:36'),
(186, 11, 22, 0, '2020-09-12 10:16:39'),
(187, 12, 19, 1, '2020-09-12 10:17:02'),
(188, 11, 21, 1, '2020-09-12 10:17:07'),
(189, 11, 22, 1, '2020-09-12 10:17:11'),
(190, 12, 22, 1, '2020-09-12 10:17:15'),
(191, 11, 22, 0, '2020-09-12 10:17:25'),
(192, 11, 22, 1, '2020-09-12 10:17:34'),
(193, 11, 22, 1, '2020-09-12 10:20:07'),
(194, 11, 22, 0, '2020-09-12 10:20:32'),
(195, 12, 26, 0, '2020-09-12 10:20:34'),
(196, 11, 21, 1, '2020-09-12 10:20:46'),
(197, 11, 22, 1, '2020-09-12 10:20:50'),
(198, 11, 33, 1, '2020-09-12 10:21:23'),
(199, 11, 22, 0, '2020-09-12 14:49:47'),
(200, 11, 22, 1, '2020-09-12 14:49:50'),
(201, 12, 25, 0, '2020-09-12 14:49:57'),
(202, 12, 19, 1, '2020-09-12 14:49:59'),
(203, 12, 25, 0, '2020-09-12 14:50:03'),
(204, 12, 19, 1, '2020-09-12 14:50:05'),
(205, 11, 22, 0, '2020-09-12 14:50:12'),
(206, 11, 21, 0, '2020-09-12 14:50:13'),
(207, 11, 21, 1, '2020-09-12 14:50:15'),
(208, 11, 22, 1, '2020-09-12 14:50:16'),
(209, 11, 30, 1, '2020-09-12 15:20:40'),
(210, 11, 29, 1, '2020-09-12 15:22:03'),
(211, 11, 30, 1, '2020-09-12 15:23:50'),
(212, 12, 30, 0, '2020-09-12 15:26:08'),
(213, 12, 34, 1, '2020-09-12 15:26:20'),
(214, 12, 34, 0, '2020-09-12 15:26:40'),
(215, 12, 34, 1, '2020-09-12 15:26:45'),
(216, 12, 34, 0, '2020-09-12 15:27:01'),
(217, 11, 21, 1, '2020-09-15 11:48:22'),
(218, 11, 21, 1, '2020-09-15 11:48:22'),
(219, 11, 22, 1, '2020-09-15 11:48:28'),
(220, 11, 22, 1, '2020-09-15 11:48:28'),
(221, 12, 22, 1, '2020-09-15 11:48:35'),
(222, 12, 22, 1, '2020-09-15 11:48:35'),
(223, 12, 19, 1, '2020-09-15 11:48:40'),
(224, 12, 19, 1, '2020-09-15 11:48:40'),
(225, 11, 21, 0, '2020-09-15 11:48:51'),
(226, 11, 21, 0, '2020-09-15 11:48:51'),
(227, 11, 22, 0, '2020-09-15 11:48:54'),
(228, 11, 22, 0, '2020-09-15 11:48:54'),
(229, 11, 21, 1, '2020-09-15 11:49:01'),
(230, 11, 21, 1, '2020-09-15 11:49:01'),
(231, 11, 21, 1, '2020-09-15 11:49:22'),
(232, 11, 21, 1, '2020-09-15 11:49:22'),
(233, 11, 22, 1, '2020-09-15 11:49:26'),
(234, 11, 22, 1, '2020-09-15 11:49:26'),
(235, 12, 19, 1, '2020-09-15 11:49:32'),
(236, 12, 19, 1, '2020-09-15 11:49:32'),
(237, 11, 33, 1, '2020-09-15 11:49:36'),
(238, 11, 33, 1, '2020-09-15 11:49:36'),
(239, 12, 22, 1, '2020-09-15 11:49:39'),
(240, 12, 22, 1, '2020-09-15 11:49:39'),
(241, 11, 33, 0, '2020-09-15 11:49:45'),
(242, 11, 33, 0, '2020-09-15 11:49:45'),
(243, 11, 21, 0, '2020-09-15 11:49:51'),
(244, 11, 21, 0, '2020-09-15 11:49:51'),
(245, 12, 35, 1, '2020-09-15 11:52:00'),
(246, 12, 35, 1, '2020-09-15 11:52:01'),
(247, 12, 35, 0, '2020-09-15 11:53:20'),
(248, 12, 35, 0, '2020-09-15 11:53:20'),
(249, 11, 21, 1, '2020-09-15 11:53:45'),
(250, 11, 21, 1, '2020-09-15 11:53:45'),
(251, 11, 22, 1, '2020-09-15 11:53:46'),
(252, 11, 22, 1, '2020-09-15 11:53:46'),
(253, 11, 33, 1, '2020-09-15 11:53:47'),
(254, 11, 33, 1, '2020-09-15 11:53:47'),
(255, 12, 36, 1, '2020-09-15 13:04:08'),
(256, 12, 36, 1, '2020-09-15 13:04:08'),
(257, 12, 36, 0, '2020-09-15 13:04:46'),
(258, 12, 36, 0, '2020-09-15 13:04:46');

--
-- Indexes for dumped tables
--

--
-- Indexes for table `beacon`
--
ALTER TABLE `beacon`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `room`
--
ALTER TABLE `room`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `track`
--
ALTER TABLE `track`
  ADD PRIMARY KEY (`id`),
  ADD KEY `room_id` (`room_id`),
  ADD KEY `bea_id` (`bea_id`);

--
-- AUTO_INCREMENT for dumped tables
--

--
-- AUTO_INCREMENT for table `beacon`
--
ALTER TABLE `beacon`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=37;

--
-- AUTO_INCREMENT for table `room`
--
ALTER TABLE `room`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=13;

--
-- AUTO_INCREMENT for table `track`
--
ALTER TABLE `track`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=259;

--
-- Constraints for dumped tables
--

--
-- Constraints for table `track`
--
ALTER TABLE `track`
  ADD CONSTRAINT `track_ibfk_1` FOREIGN KEY (`room_id`) REFERENCES `room` (`id`),
  ADD CONSTRAINT `track_ibfk_2` FOREIGN KEY (`bea_id`) REFERENCES `beacon` (`id`);
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
